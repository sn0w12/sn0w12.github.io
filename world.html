<!DOCTYPE html>
<html = style="height: 100%;">

<head>
	<title>Arathia World Map</title>
	<meta charset="UTF-8">
	<link rel="icon" href="icons/arathia.png">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="scripts/leaflet.css">
	<link rel="stylesheet" href="scripts/src/leaflet.groupedlayercontrol.css" />
	<link rel="stylesheet" href="scripts/leaflet-search/src/leaflet-search.css" />
	<link rel="stylesheet" href="style/style.css">
	<script src="scripts/leaflet.js"></script>
	<script src="scripts/src/leaflet.groupedlayercontrol.js"></script>
	<script src="scripts/leaflet-search/src/leaflet-search.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@turf/turf"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-editable/1.0.0/Leaflet.Editable.min.js"></script>
</head>

<body style="height: 100%;margin: 0;overflow-y: hidden;overflow-x: hidden;">
	<div id="map" style="width: 100%; height: 100%; background: #31565a;"></div>
	<a class="leaflet-control-zoom-out" href="index" title="Zoom out" role="button"
        aria-label="Zoom out" aria-disabled="false"><span aria-hidden="true">−</span></a>
	<script src="scripts/custom-scripts.js"></script>
	<script type="text/javascript">
		// MAPS
		var radioButtonsInfo = [
			{ label: "Default Icons", option: "option1", checkedIndex: 1, suffix: '' },
			{ label: "Old Icons", option: "option2", checkedIndex: 2, suffix: 'Old' },
			{ label: "Simple Icons", option: "option3", checkedIndex: 3, suffix: 'Simple' }
		];

		var neededMaps = [
			{ map: arathia, name: 'arathia' },
			{ map: arathiaClean, name: 'arathia clean' },
			{ map: morturia, name: 'morturia' }
		];

		const countryColors = {
			"Antaria": "#cc0000",
			"Primoria": "#674ea7",
			"Dryadalis": "#6aa84f",
			"Gigantoria": "#d5a6bd",
			"Trade Company": "#ffd966",
			"Odrheim": "#a64d79",
			"Tunglheimr": "#45818e",
			"Arcarum": "#8e7cc3",
			"Golden Order": "#f3cc52",
			"Free People of Antaria": "#a61c00",
			"Rheinland": "#666666",
			"Azurith": "#e69138",
			"Tsuki": "#3c78d8",
			"Seraphyria": "#cc0000",
			"Talasir": "#3c78d8",
			"Thyrania": "#6aa84f",
		};

		countryPolygons = {
			"Arathia": {
				"arOption1": {
					"Antaria": turf.polygon([[
						[-11.324858, -53.056488],
						[-20.92278, -65.849245],
						[-29.801983, -69.785478],
						[-29.944201, -83.890313],
						[-22.501032, -88.45768],
						[-27.353804, -111.279933],
						[-17.165309, -124.981265],
						[-4.766854, -130.176739],
						[5.178482, -137.8125],
						[4.565474, -161.191406],
						[9.210917, -167.989128],
						[63.004195, -156.054583],
						[66.517935,-141.433598],
						[66.791909, -17.841797],
						[49.74405, -10.549323],
						[38.232526, 6.825983],
						[38.679755, 47.660703],
						[37.159287, 75.716726],
						[31.504309, 91.993503],
						[27.212716, 90.137379],
						[22.419721, 100.131891],
						[25.098281, 108.270279],
						[16.704856, 113.767261],
						[-0.115382, 119.050074],
						[-10.759978, 92.207671],
						[6.651616, 73.717824],
						[7.360175, 60.867737],
						[1.169545, 42.734837],
						[2.453884, 32.240599],
						[-4.465606, 21.246636],
						[-4.679092, 14.250478],
						[4.235506, 6.183479],
						[6.864296, -11.806642],
						[5.302624, -31.010383],
						[-0.615096, -44.288806],
						[-11.324858, -53.056488]
					]]),
					"Primoria": turf.polygon([[
						[-12.506265, -54.589186],
						[-17.107815, -61.297961],
						[-21.598419, -65.734409],
						[-29.497023, -68.43956],
						[-30.620835, -82.830965],
						[-23.298448, -88.45768],
						[-22.414977, -90.991202],
						[-28.550868, -114.751751],
						[-69.38392, -110.09889],
						[-69.459985, -27.429467],
						[-37.857291, -24.075079],
						[-26.4394, -47.988617],
						[-12.506265, -54.589186]
					]]),
					"Dryadalis": turf.polygon([[
						[-20.417763, -140.569393],
						[-27.305851, -164.575674],
						[-62.682708, -166.083315],
						[-61.321926, -115.287415],
						[-38.563192, -115.51936],
						[-20.634982, -129.783962],
						[-20.417763, -140.569393]
					]]),
					"Gigantoria": turf.polygon([[
						[1.704713, -35.829382],
						[-3.947162, -44.093199],
						[-16.693686, -48.529647],
						[-33.373368, -35.436715],
						[-15.966807, -29.918206],
						[2.325024, -31.541297],
						[1.704713, -35.829382]
					]]),
					"Trade Company": turf.polygon([[
						[5.239907, -31.433091],
						[-29.77917, -28.944351],
						[-21.497776, -14.769359],
						[-8.356947, -8.060583],
						[5.347651, -20.179661],
						[5.239907, -31.433091]
					]]),
					"Odrheim": turf.polygon([[
						[38.479395, 2.636719],
						[67.974634, 3.427734],
						[67.474922, 79.804688],
						[54.41893, 78.486328],
						[52.908902, 72.685547],
						[53.225768, 69.257813],
						[51.727028, 63.632813],
						[46.679594, 55.986328],
						[38.822591, 47.373047],
						[38.479395, 2.636719]
					]]),
					"Tunglheimr": turf.polygon([[
						[38.745724, 47.361506],
						[47.635784, 59.238281],
						[51.508742, 64.072266],
						[52.802761, 70.048828],
						[52.696361, 74.53125],
						[54.521081, 79.101563],
						[47.338823, 77.080078],
						[42.811522, 74.882813],
						[37.649034, 75.234375],
						[38.745724, 47.361506]
					]]),
					"Arcarum": turf.polygon([[
						[6.087936, -16.710896],
						[-4.276129, -11.666098],
						[-8.30985, -7.781023],
						[-4.854148, 6.251634],
						[3.430009, 8.513096],
						[3.603639, -0.822681],
						[5.914931, -8.59283],
						[6.087936, -16.710896]
					]]),
					"Golden Order": turf.polygon([[
						[31.382497, 91.993503],
						[29.78467, 99.13244],
						[25.485557, 107.913332],
						[22.749294, 100.417448],
						[27.339618, 90.280158],
						[31.382497, 91.993503]
					]]),
					"Free People of Antaria": turf.polygon([[
						[4.302591, -161.455078],
						[-16.972741, -153.28125],
						[-14.093957, -126.123047],
						[-5.090944, -130.341797],
						[2.899153, -135.263672],
						[4.65308, -139.21875],
						[4.302591, -161.455078]
					]]),
					"Rheinland": turf.polygon([[
						[66.407955, 80.771484],
						[59.085739, 141.943359],
						[-1.58183, 162.949219],
						[-2.108899, 151.171875],
						[-1.230374, 139.21875],
						[1.406109, 133.154297],
						[0, 127.617188],
						[0.878872, 123.222656],
						[0.263671, 119.707031],
						[12.554564, 114.785156],
						[25.244696, 108.808594],
						[31.503629, 93.164063],
						[37.439974, 76.728516],
						[43.580391, 75.849609],
						[51.234407, 78.222656],
						[66.407955, 80.771484]
					]]),
					"Azurith": turf.polygon([[
						[-14.244218, 87.852919],
						[-7.376635, 97.91882],
						[-2.185144, 112.410863],
						[-0.186772, 122.97649],
						[-0.972008, 128.259303],
						[0.455728, 132.471276],
						[-2.25648, 138.967709],
						[-3.183486, 161.312582],
						[-67.040988, 161.938609],
						[-67.521017, 82.389096],
						[-58.004872, 83.303947],
						[-25.47065, 87.633508],
						[-14.244218, 87.852919]
					]]),
					"Tsuki": turf.polygon([[
						[-9.227056, -8.281838],
						[-26.778009, -19.584528],
						[-47.283824, -18.204425],
						[-68.71374, 17.959715],
						[-68.891647, 78.151277],
						[-61.555619, 82.169514],
						[-26.549734, 87.089805],
						[-7.360757, 84.79367],
						[5.076992, 75.199102],
						[7.68466, 64.128447],
						[3.02475, 51.132943],
						[-0.082657, 43.217209],
						[1.803157, 32.474574],
						[-6.302278, 23.782059],
						[-4.996603, 9.349205],
						[-9.227056, -8.281838]
					]]),
				},
				"arOption2": {
					"Seraphyria": turf.polygon([[
						[5.878332109674327, -26.982421875000004],
						[7.972197714386879, -34.62890625000001],
						[15.623036831528264, -42.5390625],
						[23.40276490540795, -50.36132812500001],
						[25.799891182088334, -56.07421875000001],
						[30.751277776257812, -62.31445312500001],
						[36.03133177633189, -67.41210937500001],
						[37.71859032558816, -76.025390625],
						[35.81781315869664, -81.12304687500001],
						[37.85750715625203, -87.18750000000001],
						[37.92686760148135, -89.20898437500001],
						[35.81781315869664, -93.95507812500001],
						[42.22851735620852, -97.82226562500001],
						[46.55886030311719, -97.998046875],
						[50.964278144331004, -97.33110864429017],
						[51.76654784665035, -97.90222361047816],
						[52.5981919824005, -99.40140039672158],
						[54.047811302907725, -100.75779844141805],
						[54.630465437398826, -102.32836459843496],
						[55.20489064075569, -104.0417094969989],
						[58.14462509544312, -103.25642641849046],
						[62.84629991540713, -103.32781578926394],
						[66.75933078910334, -103.89893075545194],
						[67.23194118052457, -54.762642910370964],
						[65.99841704263515, -25.042909054201004],
						[57.72733720042586, -6.67413535545888],
						[55.525825687148014, -6.250240577795604],
						[50.00669924199102, -9.40590170040001],
						[48.438027551024256, -13.268054119109907],
						[46.85159828869581, -15.340428587685938],
						[43.77233563674338, -16.565013500935418],
						[41.02530144840637, -15.811422785089583],
						[33.30606018069124, -18.0250955128867],
						[28.747367670207666, -20.097469981462755],
						[27.41767275597948, -21.13365721575076],
						[22.639886569584238, -21.27495547497187],
						[15.251266867197126, -21.463353153933323],
						[9.549773460842715, -23.629926461990074],
						[5.878332109674327, -26.982421875000004]
					]]),
					"Talasir": turf.polygon([[
						[35.80307977946787, -94.47450858108323],
						[35.10444002443079, -98.628176595812],
						[35.603665548899734, -100.31146772406036],
						[33.23711507341805, -104.09887276261918],
						[30.968893161807394, -106.04996020672525],
						[30.574447519857014, -109.18700276391539],
						[27.531731981864475, -115.53760111139786],
						[24.57648522303985, -119.24849291685447],
						[23.773761425278643, -122.19425239128913],
						[19.652027655635113, -127.35889562568754],
						[14.830770514628693, -128.85090367118036],
						[11.253516939136423, -129.57777938565127],
						[8.91843388282929, -132.9061050255969],
						[7.36577299000927, -133.8242638228233],
						[5.731528573089223, -132.44702562698373],
						[3.596377193021546, -129.1952132201403],
						[-0.7242373004451226, -126.32596697880784],
						[-3.9728815486852866, -126.67027652776774],
						[-7.208786683444186, -127.05284269327872],
						[-10.082934426941714, -127.05284269327872],
						[-14.381459865976025, -128.58310735532268],
						[-18.490081813978378, -150.88671480461352],
						[8.686486207445412, -164.21439353718313],
						[53.481868739348826, -161.7284712595742],
						[66.91018317184924, -144.94849588571373],
						[66.89559561140706, -123.57421875000001],
						[65.94647177615741, -104.28222656250001],
						[63.97596090918338, -103.79882812500001],
						[61.71070595883174, -103.447265625],
						[59.689926220143356, -103.35937500000001],
						[57.18390185831188, -103.79882812500001],
						[55.32914440840507, -104.677734375],
						[54.754247311046015, -103.93462544083874],
						[53.732270328821045, -100.9005771829651],
						[52.05280861218409, -99.2229269697879],
						[51.143775654535446, -97.9022236104782],
						[46.37186299768739, -98.25917046434567],
						[42.63140733630339, -98.18778109357218],
						[39.89528525365513, -97.04555116119624],
						[35.80307977946787, -94.47450858108323]
					]]),
					"Thyrania": turf.polygon([[
						[-14.86061949410049, -128.44491405121374],
						[-10.704320522880852, -120.58509474636001],
						[-4.766853574533522, -112.9917099942132],
						[0.2898929623356212, -103.79971792582495],
						[2.287545369456524, -94.74094313379014],
						[8.517815535260855, -86.21503744716915],
						[9.862022086311683, -81.98654839608386],
						[12.52630671574449, -78.16088674097394],
						[12.52630671574449, -75.98025959756127],
						[13.421017954642247, -72.99624350657555],
						[12.638320239230497, -69.9357141824876],
						[13.160394498038212, -68.02288335493266],
						[13.123139804427804, -66.37784884323538],
						[13.829996223915632, -64.15896508327162],
						[11.928089157417517, -61.13669237573479],
						[10.915631197335667, -59.10909169852653],
						[7.707107748638696, -55.7425094420298],
						[3.3290700357336167, -50.34832650832482],
						[1.609185426245214, -48.35898244766764],
						[0.11738889460474998, -45.10717004082422],
						[-0.7624906964902577, -42.54397673190058],
						[0.0026191270773571695, -37.53235996370659],
						[-1.183251869467516, -33.85972477480105],
						[-4.812047470698273, -31.449557932081788],
						[-10.158257114361495, -30.60791236795762],
						[-14.97358801985371, -29.995806503140038],
						[-20.114788237028648, -30.110576352793327],
						[-27.798156512856618, -31.3347880824285],
						[-34.84937368555725, -31.52607116518401],
						[-41.02795146530955, -31.14350499967301],
						[-46.54553519740885, -29.268930788669135],
						[-54.185891431601966, -28.848108006607067],
						[-68.12634475443879, -36.078608534764804],
						[-67.89716432620297, -72.38413764175796],
						[-65.6351606042577, -75.98025959756127],
						[-63.10530123392557, -85.2001041863762],
						[-58.585125791960955, -96.71534576825704],
						[-47.63940207661512, -109.22525938046648],
						[-39.48063339638161, -115.57585772794897],
						[-32.170399323783755, -114.16036291555828],
						[-23.17241724958376, -120.20490833063195],
						[-14.86061949410049, -128.44491405121374]
					]])
				}
			},
			"Morturia": {
				"moOption1": {
					"Scientia": turf.polygon([[
						[45.291623, -5.485368],
						[65.082916, 30.568977],
						[64.715705, 128.820072],
						[20.992086, 139.099647],
						[-7.392287, 105.880389],
						[-9.746073, 58.16152],
						[30.619514, 18.99093],
						[39.711555, -0.918984],
						[45.291623, -5.485368]
					]]),
					"Ardeat": turf.polygon([[
						[66.034707, -131.453127],
						[55.119416, -20.418557],
						[-13.247799, -63.389099],
						[-21.8391, -165.239127],
						[21.380443, -165.731156],
						[66.034707, -131.453127]
					]]),
					"Gelida": turf.polygon([[
						[13.688048, -35.425543],
						[-13.407391, 9.59522],
						[-8.578925, 96.848383],
						[-54.743236, 88.811907],
						[-67.647149, 22.551986],
						[-54.458219, -107.179691],
						[-13.407391, -68.63741],
						[13.688048, -35.425543]
					]]),
				}
			}
		}

		var oldSuffix = "";
		var currentSelectedMap = arathia;
		var selectedOptionId = 'arOption1';
		var iconChecked = 1;
		var currentMap = 'Arathia';
		var currentSelectedCategories = "capitals-largecities-smallcities-towns-nature-locations-characters";

		// Define a map to convert between optionIds when switching map types
		var optionIdConversions = {
			'arOption2': 'arCleanOption2',
			'moOption2': 'moCleanOption2'
		};

		const regionMap = {
			"arathia": "ar",
			"an": "ar",
			"od": "ar",
			"th": "ar",
			"rh": "ar",
			"az": "ar",
			"ts": "ar",
			"pr": "ar",
			"dr": "ar",
			"tc": "ar",
			"gi": "ar",
			"ac": "ar",
			"go": "ar",
			"fp": "ar",
			"se": "ar1213BR",
			"ta": "ar1213BR",
			"ty": "ar1213BR",
			"da": "ar1213BR",
			"sc": "mo",
		};

		const regionToFull = {
			"ar": ["arathia", "arOption1"],
			"mo": ["morturia", "moOption1"],
			"ar1213BR": ["arathia", "arOption2"],
		}

		var southWest = L.latLng(-70, -170),
			northEast = L.latLng(70, 170),
			bounds = L.latLngBounds(southWest, northEast);

		worldSize = 126000000 * 2.005012531328321;
		const maxLatitude = 70; // Maximum latitude considered in the model
		const northPoleCorrection = 1.0985; // Correction at the north pole
		const southPoleCorrection = 1.1545; // Correction at the south pole
		polygonScale = 0.19;

		//Creating the Map
		var map = L.map('map', {
			maxBounds: bounds,
			zoomSnap: 0.1,
			zoomDelta: 0.5,
			wheelPxPerZoomLevel: 120,
		}).setView([0, 0], 0);

		map.createPane('addPane');
		map.createPane('basePane');
		map.createPane('backgroundPane');

		map.getPane('addPane').style.zIndex = 250;
		map.getPane('basePane').style.zIndex = 220;
		map.getPane('backgroundPane').style.zIndex = 150;

		// Maps createMap(title, noWrap, minZoom, maxZoom, pane, add)
		var arathia = createMap('Main', 'arathia', true, 2.75, 5.4, 'basePane', true);
		var arathiaClean = createMap('Main', 'arathiaClean', true, 2.75, 5.4, 'basePane', false);
		var arathia1213BR = createMap('Main', 'arathia1213BR', true, 2.75, 5.4, 'addPane', false);
		var Test2 = createMap('Main', 'morturia', true, 2.75, 5.4, 'addPane', false);
		var Test3 = createMap('Main', 'morturia', true, 2.75, 5.4, 'addPane', false);
		var Test4 = createMap('Main', 'morturia', true, 2.75, 5.4, 'addPane', false);
		var morturia = createMap('Main', 'morturia', true, 2.75, 5.4, 'basePane', false);
		var arathiaBackground = createMap('Main', 'arathiaBackground', false, 2.75, 5.4, 'backgroundPane', true);
		var morturiaBackground = createMap('Main', 'morturiaBackground', false, 2.75, 5.4, 'backgroundPane', false);

		const backgrounds = [arathiaBackground, morturiaBackground]

		// Icons Settings: { size = image size, anchor = where on the image is on the coordinate, popupAnchor = where the popup will be anchored to the marker }
		var defaultIconSettings = { size: [31, 41], anchor: [15, 41], popupAnchor: [1, -44] };
		var oldIconSettings = { size: [31, 41], anchor: [15, 41], popupAnchor: [1, -44] };
		var simpleIconSettings = { size: [31, 41], anchor: [15, 25], popupAnchor: [1, -22] };

		// Icons
		var icons = {
			capital: createIcon('capital', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			cityBig: createIcon('cityBig', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			citySmall: createIcon('citySmall', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			town: createIcon('town', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			nature: createIcon('nature', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			important: createIcon('important', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			character: createIcon('character', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
	
			capitalOld: createIcon('capitalOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			cityBigOld: createIcon('cityBigOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			citySmallOld: createIcon('citySmallOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			townOld: createIcon('townOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			natureOld: createIcon('natureOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			importantOld: createIcon('importantOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			characterOld: createIcon('characterOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),

			capitalSimple: createIcon('capitalSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, adjustSettings(simpleIconSettings, { popupAnchor: [0.5, 0] }).popupAnchor),
			cityBigSimple: createIcon('cityBigSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, simpleIconSettings.popupAnchor),
			citySmallSimple: createIcon('citySmallSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, adjustSettings(simpleIconSettings, { popupAnchor: [0, 4] }).popupAnchor),
			townSimple: createIcon('townSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, adjustSettings(simpleIconSettings, { popupAnchor: [0, 6] }).popupAnchor),
			natureSimple: createIcon('natureSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, adjustSettings(simpleIconSettings, { popupAnchor: [0, 8] }).popupAnchor),
			importantSimple: createIcon('importantSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, adjustSettings(simpleIconSettings, { popupAnchor: [0.5, 0] }).popupAnchor),
			characterSimple: createIcon('characterSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, simpleIconSettings.popupAnchor),

			defaultIcon: createIcon('marker-icon', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor)
		}

		var fileInput = createFileInput();

		var formHTML = `
			<div class="custom-container">
				<span class="custom-title"><font size="+0.5">Marker Maker</font></span>
				<span class="custom-subtitle"><font size="-1">Coords</font></span>
				<input class="custom-input" type="text" id="Coords" placeholder="Coords"></input>
				<img style="height:3px;width: 100%; display: block; margin-left: auto; margin-right: auto; margin-bottom: 0px; margin-top: 0px;" src="icons/divider_small.png" alt="map popup divider">
				<span class="custom-subtitle"><font size="-1">Country</font></span>
				<select class="custom-select" name="Id" id="Id">
					<option value="ac">Arcarum</option>
					<option value="an">Antaria</option>
					<option value="az">Azurith</option>
					<option value="dr">Dryadalis</option>
					<option value="fp">Free People of Antaria</option>
					<option value="gi">Gigantoria</option>
					<option value="go">Golden Order</option>
					<option value="od">Odrheim</option>
					<option value="pr">Primoria</option>
					<option value="rh">Rheinland</option>
					<option value="tc">Trade Company</option>
					<option value="th">Tunglheimr</option>
					<option value="ts">Tsuki</option>
					<option disabled>─────────────────────────</option>
					<option value="ad">Ardeat</option>
					<option value="ge">Gelida</option>
					<option value="sc">Scientia</option>
				</select>
				<input class="custom-input" type="text" id="Title" placeholder="Title"></input>
				<span class="custom-subtitle"><font size="-1">Category</font></span>
				<select class="custom-select" name="Category" id="Category">
					<option value="capital" id="Capital">Capital</option>
					<option value="cityBig" id="Big City">Big City</option>
					<option value="citySmall" id="Small City">Small City</option>
					<option value="town"id="Town">Town</option>
					<option disabled>─────────────────────────</option>
					<option value="nature" id="Forest">Forest</option>
					<option value="nature" id="Mountain">Mountain</option>
					<option value="nature" id="Cave">Cave</option>
					<option disabled>─────────────────────────</option>
					<option value="important" id="Important Location">Important Location</option>
					<option value="important" id="Historical Location">Historical Location</option>
					<option disabled>─────────────────────────</option>
					<option value="character" id="Character">Character</option>
					</select>
				<input class="custom-input" type="text" id="Description" placeholder="Description"></input>
				<div class="custom-checkbox-container">
					<input class="custom-checkbox" type="checkbox" id="Link">
					<label for="Link">Link?</label>
				</div>
				<input class="custom-input" type="text" id="LinkText" placeholder="Custom link text (optional)"></input>
				<input class="custom-input" type="text" id="CustomId" placeholder="Custom id name (optional)"></input>
				<button class="custom-button" id="DevButton">Generate</button>
				<input class="custom-input" type="text" id="Output" placeholder="Output"></input>
			</div>
			`;

		var formHTML1213BR = `
			<div class="custom-container">
				<span class="custom-title"><font size="+0.5">Marker Maker</font></span>
				<span class="custom-subtitle"><font size="-1">Coords</font></span>
				<input class="custom-input" type="text" id="Coords" placeholder="Coords"></input>
				<img style="height:3px;width: 100%; display: block; margin-left: auto; margin-right: auto; margin-bottom: 0px; margin-top: 0px;" src="icons/divider_small.png" alt="map popup divider">
				<span class="custom-subtitle"><font size="-1">Country</font></span>
				<select class="custom-select" name="Id" id="Id">
					<option value="da">Drakoria</option>
					<option value="se">Seraphyria</option>
					<option value="ta">Talasir</option>
					<option value="ty">Thyrania</option>
					<option disabled>─────────────────────────</option>
					<option value="ad">Ardeat</option>
					<option value="ge">Gelida</option>
					<option value="sc">Scientia</option>
				</select>
				<input class="custom-input" type="text" id="Title" placeholder="Title"></input>
				<span class="custom-subtitle"><font size="-1">Category</font></span>
				<select class="custom-select" name="Category" id="Category">
					<option value="capital" id="Capital">Capital</option>
					<option value="cityBig" id="Big City">Big City</option>
					<option value="citySmall" id="Small City">Small City</option>
					<option value="town"id="Town">Town</option>
					<option disabled>─────────────────────────</option>
					<option value="nature" id="Forest">Forest</option>
					<option value="nature" id="Mountain">Mountain</option>
					<option value="nature" id="Cave">Cave</option>
					<option disabled>─────────────────────────</option>
					<option value="important" id="Important Location">Important Location</option>
					<option value="important" id="Historical Location">Historical Location</option>
					<option disabled>─────────────────────────</option>
					<option value="character" id="Character">Character</option>
					</select>
				<input class="custom-input" type="text" id="Description" placeholder="Description"></input>
				<div class="custom-checkbox-container">
					<input class="custom-checkbox" type="checkbox" id="Link">
					<label for="Link">Link?</label>
				</div>
				<input class="custom-input" type="text" id="LinkText" placeholder="Custom link text (optional)"></input>
				<input class="custom-input" type="text" id="CustomId" placeholder="Custom id name (optional)"></input>
				<button class="custom-button" id="DevButton">Generate</button>
				<input class="custom-input" type="text" id="Output" placeholder="Output"></input>
			</div>
			`;

		var polygonHTML = `
			<div class="custom-container">
				<span class="custom-title"><font size="+0.5">Polygon Maker</font></span>
				<span class="custom-subtitle"><font size="-1">Coords</font></span>
				<input class="custom-input" type="text" id="Coords" placeholder="Coords"></input>
				<img style="height:3px;width: 100%; display: block; margin-left: auto; margin-right: auto; margin-bottom: 0px; margin-top: 0px;" src="icons/divider_small.png" alt="map popup divider">
				<button class="custom-button" id="DevButton">Add point</button>
				<button class="custom-button" id="DevButton2">Finsh polygon</button>
				<button class="custom-button" id="DevButton3">Remove last point</button>
			</div>
			`;

		//Marker Maker
		var marker = L.marker([0, 0], {
			draggable: true,
			id: "markerMaker"
		}).on('dragend', function() {
			resetAndOpenPopup();
			markerMaker(true);
		}).on('click', function() {
			resetAndOpenPopup();
			markerMaker(true);
		});

		//Polygon Maker
		var polygonMarker = L.marker([0, 0], {
			draggable: true,
			id: "markerMaker"
		}).on('dragend', function() {
			polygonMarker.openPopup();
			polygonMaker(true);
		});

		polygonMarker.bindPopup(polygonHTML).openPopup();
		polygonMarker.on('click', function(e) {
			polygonMaker();
		});

		var regionLayerGroups = {
			'ar': {
				'capital': L.layerGroup().addTo(map),
				'cityBig': L.layerGroup().addTo(map),
				'citySmall': L.layerGroup().addTo(map),
				'town': L.layerGroup().addTo(map),
				'nature': L.layerGroup().addTo(map),
				'important': L.layerGroup().addTo(map),
				'character': L.layerGroup().addTo(map)
			},
			'ar1213BR': {
				'capital': L.layerGroup(),
				'cityBig': L.layerGroup(),
				'citySmall': L.layerGroup(),
				'town': L.layerGroup(),
				'nature': L.layerGroup(),
				'important': L.layerGroup(),
				'character': L.layerGroup()
			},
			'mo': {
				'capital': L.layerGroup(),
				'cityBig': L.layerGroup(),
				'citySmall': L.layerGroup(),
				'town': L.layerGroup(),
				'nature': L.layerGroup(),
				'important': L.layerGroup(),
				'character': L.layerGroup()
			},
		};

		//Marker Groups		
		var dv_coord = L.layerGroup([marker, polygonMarker]);

		const regionCodes = ['ar', 'ar1213BR', 'mo'];
		const layerTypes = ['capital', 'cityBig', 'citySmall', 'town', 'nature', 'important', 'character'];

		const layerGroups = [];

		var ar_all_layers = createLayerGroup(regionCodes[0], layerTypes);
		var ar1213BR_all_layers = createLayerGroup(regionCodes[1], layerTypes);
		var mo_all_layers = createLayerGroup(regionCodes[2], layerTypes);
		
		//Marker Overlay
		var overlays = {
			"Arathia": {
				"Capitals": regionLayerGroups['ar']['capital'],
				"Large Cities": regionLayerGroups['ar']['cityBig'],
				"Small Cities": regionLayerGroups['ar']['citySmall'],
				"Towns": regionLayerGroups['ar']['town'],
				"Nature": regionLayerGroups['ar']['nature'],
				"Locations": regionLayerGroups['ar']['important'],
				"Characters": regionLayerGroups['ar']['character'],
			},
			"Morturia": {
				"Capitals": regionLayerGroups['mo']['capital'],
				"Large Cities": regionLayerGroups['mo']['cityBig'],
				"Small Cities": regionLayerGroups['mo']['citySmall'],
				"Towns": regionLayerGroups['mo']['town'],
				"Nature": regionLayerGroups['mo']['nature'],
				"Locations": regionLayerGroups['mo']['important'],
				"Characters": regionLayerGroups['mo']['character'],
			},
			"Arathia 1213 B.R": {
				"Capitals": regionLayerGroups['ar1213BR']['capital'],
				"Large Cities": regionLayerGroups['ar1213BR']['cityBig'],
				"Small Cities": regionLayerGroups['ar1213BR']['citySmall'],
				"Towns": regionLayerGroups['ar1213BR']['town'],
				"Nature": regionLayerGroups['ar1213BR']['nature'],
				"Locations": regionLayerGroups['ar1213BR']['important'],
				"Characters": regionLayerGroups['ar1213BR']['character'],
			},
			"Developer": {
				"Marker Maker": marker,
				"Polygon Maker": polygonMarker,
			}
		};
		var options = {
			groupCheckboxes: true
		};
		var mapLayers = {
			"Arathia": arathia,
			"Arathia Clean": arathiaClean,
			"Morturia": morturia,
		}

		//GROUP CONTROLS
		L.control.groupedLayers(mapLayers, overlays, options).addTo(map);

		var controlSearchAr = new L.Control.Search({
			position:'topleft',		
			layer: ar_all_layers, 
			zoom: 5,
			initial: false,
			marker: false
		}).on("search:locationfound", function (e) {
			if (e.layer._popup) e.layer.openPopup();
		});

		var controlSearchMo = new L.Control.Search({
			position:'topleft',		
			layer: mo_all_layers, 
			zoom: 5,
			initial: false,
			marker: false
		}).on("search:locationfound", function (e) {
			if (e.layer._popup) e.layer.openPopup();
		});

		var controlSearchAr1213BR = new L.Control.Search({
			position:'topleft',		
			layer: ar1213BR_all_layers, 
			zoom: 5,
			initial: false,
			marker: false
		}).on("search:locationfound", function (e) {
			if (e.layer._popup) e.layer.openPopup();
		});

		var allSearch = [
			controlSearchAr, 
			controlSearchMo,
			controlSearchAr1213BR
		];

		map.addControl( controlSearchAr );

		// Background color and Search to use for map
		var mapConfigurations = {
			'Arathia': {
				color: '#31565a',
				options: {
					'arOption1': {
						search: { controlSearch1: controlSearchAr },
						mapLayer: arathia,
						show: [ar_all_layers, arathiaBackground],
						checkboxIndex: 0,
						checkboxState: true,
						hideCheckboxes: [2, 3],
						form: formHTML,
						defaultFormSelect: 0,
					},
					'arOption2': {
						search: { controlSearch1: controlSearchAr1213BR },
						mapLayer: arathia1213BR,
						show: [ar1213BR_all_layers, arathiaBackground],
						checkboxIndex: 2,
						checkboxState: true,
						hideCheckboxes: [1, 2],
						form: formHTML1213BR,
						defaultFormSelect: 0,
					},
				},
				current: arathia, 
				defaultOptionId: 'arOption1',
			},
			'Arathia Clean': {
				color: '#31565a',
				options: {
					'arCleanOption1': {
						search: { controlSearch1: controlSearchAr },
						mapLayer: arathiaClean,
						show: [arathiaBackground],
						checkboxIndex: 0,
						checkboxState: false,
						hideCheckboxes: [2, 3],
						form: formHTML,
						defaultFormSelect: 0,
					},
					'arCleanOption2': {
						search: { controlSearch1: controlSearchMo },
						mapLayer: Test3,
						show: [arathiaBackground],
						checkboxIndex: 1,
						checkboxState: false,
						hideCheckboxes: [1, 3],
						form: formHTML1213BR,
						defaultFormSelect: 0,
					},
				},
				current: arathiaClean,
				defaultOptionId: 'arCleanOption1',
			},
			'Morturia': {
				color: '#374539',
				options: {
					'moOption1': {
						search: { controlSearch1: controlSearchMo },
						mapLayer: morturia,
						show: [mo_all_layers, morturiaBackground],
						checkboxIndex: 1,
						checkboxState: true,
						hideCheckboxes: [1, 3],
						form: formHTML,
						defaultFormSelect: 0,
					},
					'moOption2': {
						search: { controlSearch1: controlSearchAr },
						mapLayer: morturia,
						show: [mo_all_layers, morturiaBackground],
						checkboxIndex: 1,
						checkboxState: true,
						hideCheckboxes: [1, 3],
						form: formHTML1213BR,
						defaultFormSelect: 0,
					},
				},
				current: morturia,
				defaultOptionId: 'moOption1',
			},
			'Morturia Clean': {
				color: '#374539',
				options: {
					'moCleanOption1': {
						search: { controlSearch1: controlSearchMo },
						mapLayer: morturia,
						show: [mo_all_layers, morturiaBackground],
						checkboxIndex: 1,
						checkboxState: true,
						hideCheckboxes: [1, 3],
						form: formHTML,
						defaultFormSelect: 0,
					},
					'moCleanOption2': {
						search: { controlSearch1: controlSearchAr },
						mapLayer: morturia,
						show: [morturiaBackground],
						checkboxIndex: 1,
						checkboxState: true,
						hideCheckboxes: [1, 3],
						form: formHTML1213BR,
						defaultFormSelect: 0,
					},
				},
				current: morturia,
				defaultOptionId: 'moCleanOption1',
			},
		};

		function addYearSelect() {
			var existingDropdown = document.getElementById('YearSelector');
			if (existingDropdown) {
				// If it exists, remove it before creating a new one
				existingDropdown.remove();
			}

			// Find the checked radio button
			var checkedRadioButton = document.querySelector('.leaflet-control-layers-base input[type="radio"]:checked');
			if (checkedRadioButton) {
				var label = checkedRadioButton.nextElementSibling;
			} else {
				console.error("No radiobutton found.");
			}

			// Create the dropdown box
			var dropdown = document.createElement('select');
			dropdown.name = 'options';
			dropdown.id = "YearSelector";
			dropdown.className = 'custom-select';

			// Add options to the dropdown
			switch (label && label.textContent.trim()) {
				case "Arathia": {
					createSelect("1257 A.A", "arOption1", dropdown);
					createSelect("1213 B.R", "arOption2", dropdown);
					break;
				}
				case "Arathia Clean": {
					createSelect("1257 A.A", "arCleanOption1", dropdown);
					createSelect("1213 B.R", "arCleanOption2", dropdown); 
					break;
				}
				case "Morturia": {
					createSelect("1257 A.A", "moOption1", dropdown);
					createSelect("???", "moOption2", dropdown); 
					break;
				}
			}

			// Insert the dropdown after the parent label of the checked radio button
			if (checkedRadioButton) {
				checkedRadioButton.closest('label').after(dropdown);
			} else if (lastCheckedRadioButtonLabel) {
				// Find the label with the text in lastCheckedRadioButtonLabel
				var labels = document.getElementsByTagName('label');
				for (var i = 0; i < labels.length; i++) {
					var label = labels[i];
					var span = label.querySelector('span');
					if (span && span.textContent.trim() === lastCheckedRadioButtonLabel) {
						console.log("Found Label")
						label.after(dropdown);
						break;
					}
				}
			} else {
				console.log("No radiobutton found");
			}
		}

		function addRadioButtons(checked) {
			// Simplified createRadioButton function
			function createRadioButton(label, value, isChecked) {
				var radio = document.createElement("input");
				radio.type = "radio";
				radio.name = "layerSelector";
				radio.value = value;
				radio.checked = isChecked; // Direct assignment
				radio.classList.add("custom-radio-class");

				var labelElement = document.createElement("label");
				labelElement.appendChild(radio);
				labelElement.appendChild(document.createTextNode(label));
				return labelElement;
			}

			// Get the overlay control container
			var overlayContainer = document.querySelector('.leaflet-control-layers-overlays');

			// Check and remove existing radio buttons and separators
			var existingRadios = overlayContainer.querySelectorAll('.custom-radio-class');
			var existingSeparators = overlayContainer.querySelectorAll('.leaflet-control-layers-separator');

			existingRadios.forEach(function(radio) {
				radio.parentNode.remove(); // This assumes the radio button is wrapped in a label
			});
			existingSeparators.forEach(function(separator) {
				separator.remove();
			});

			// Create and append the separator div
			var separatorDiv = document.createElement("div");
			separatorDiv.classList.add("leaflet-control-layers-separator");
			overlayContainer.appendChild(separatorDiv);

			// Loop to create and append radio buttons
			radioButtonsInfo.forEach(info => {
				var radioButton = createRadioButton(info.label, info.option, checked === info.checkedIndex);
				radioButton.classList.add("leaflet-control-layers-selector");
				overlayContainer.appendChild(radioButton);
			});
		};

		document.addEventListener('DOMContentLoaded', function () {
			// Check the main checkbox
			var checkbox = document.querySelector('.leaflet-control-layers-group-selector');
			checkbox.checked = true;
			addRadioButtons(1)
			hideCheckBoxes(mapConfigurations[currentMap].options[selectedOptionId].hideCheckboxes);
			addYearSelect();
			attachEventListenersToCheckboxes();
			document.getElementById('YearSelector').addEventListener('change', updateSelectedOptionId);
			fetch('data/markers.json')
				.then(response => response.json())
				.then(data => processImportedData(data))
				.then(() => {
					map.whenReady(() => {
						checkUrl();
					});
				})
				.catch(error => console.error('Error loading markers.json:', error));
		});

		const zoomControl = document.querySelector('.leaflet-control-zoom.leaflet-bar.leaflet-control');

		if (zoomControl) {
			const wikiButton = createControlButton('wiki', 'Wiki', 'icons/web1.png', 'icons/web2.png', (e) => {
				e.preventDefault();
				window.open('wiki', '_blank');
			});

			const cityButton = createControlButton('city', 'Opens the city map', 'icons/city1.png', 'icons/city2.png', (e) => {
				e.preventDefault();
				window.open('cities');
			});

			const exportButton = createControlButton('#', 'Export JSON', 'icons/export1.png', 'icons/export2.png', (e) => {
				e.preventDefault();
				exportMarkersToJson();
			});

			const importButton = createControlButton('#', 'Import JSON', 'icons/import1.png', 'icons/import2.png', (e) => {
				e.preventDefault();
				fileInput.click();
			});

			zoomControl.insertAdjacentElement('beforeend', wikiButton);
			zoomControl.insertAdjacentElement('beforeend', cityButton);
			zoomControl.insertAdjacentElement('beforeend', exportButton);
			zoomControl.insertAdjacentElement('beforeend', importButton);
		} else {
			console.error('Zoom control element not found');
		}

		document.getElementsByClassName('leaflet-control-attribution')[0].style.display = 'none';

		function createFileInput() {
			var fileInput = document.createElement('input');
			fileInput.type = 'file';
			fileInput.accept = '.json';
			fileInput.style.display = 'none';

			fileInput.addEventListener('change', function(event) {
				var file = event.target.files[0];
				if (file) {
					var reader = new FileReader();
					reader.onload = function(e) {
						var jsonData = JSON.parse(e.target.result);
						processImportedData(jsonData);
					};
					reader.readAsText(file);
				}
			});

			document.body.appendChild(fileInput);
			return fileInput;
		}
	</script>		
</body>

</html>